"use strict";(self.webpackChunkecom=self.webpackChunkecom||[]).push([[5488],{55488:(e,t,a)=>{a.r(t),a.d(t,{default:()=>S});var s=a(11504),l=a.n(s),n=a(96800),c=a(66564),o=a(83284),r=a(44484),i=a(52328),d=a(30919),u=a(27520),m=a(85704),g=a(86944),v=a(85976),p=a(93736),f=a(89340),E=a(92976),x=a(32360),h=a(17554),b=a(33280),w=a(17652);d.c.addLocale(u.c);const N=new d.c("en-US"),y=e=>{var t;let{data:a,index:n,setOpen:r,setCurrentChat:i,me:d,setUserData:u,userData:g,online:v,setActiveStatus:p,loading:f}=e;const[E,x]=(0,s.useState)(0),[h,b]=(0,s.useState)([]),w=(0,o.i6)();return(0,s.useEffect)((()=>{p(v);const e=a.members.find((e=>e!==d));(async()=>{try{const t=await c.c.get("".concat(m.Yb,"/shop/get-shop-info/").concat(e));b(t.data.shop)}catch(e){console.log(e)}})()}),[d,a,p,v]),l().createElement("div",{className:"w-full flex p-3 px-3 ".concat(E===n?"bg-[#00000010]":"bg-transparent","  cursor-pointer"),onClick:e=>{return x(n)||(t=a._id,w("/inbox?".concat(t)),void r(!0))||i(a)||u(h)||p(v);var t}},l().createElement("div",{className:"relative"},l().createElement("img",{src:"".concat(null==h||null===(t=h.avatar)||void 0===t?void 0:t.url),alt:"",className:"w-[50px] h-[50px] rounded-full"}),v?l().createElement("div",{className:"w-[12px] h-[12px] bg-green-400 rounded-full absolute top-[2px] right-[2px]"}):l().createElement("div",{className:"w-[12px] h-[12px] bg-[#c7b9b9] rounded-full absolute top-[2px] right-[2px]"})),l().createElement("div",{className:"pl-3"},l().createElement("h1",{className:"text-[18px]"},null==h?void 0:h.name),l().createElement("p",{className:"text-[16px] text-[#000c]"},f||(null==a?void 0:a.lastMessageId)===(null==g?void 0:g._id)?null!=a&&a.lastMessage?(null==g?void 0:g.name.split(" ")[0])+": ":"Hi This is AirBee! feel free to ask your queries":(null==a?void 0:a.lastMessage)&&"You:"," ",null==a?void 0:a.lastMessage)))},I=e=>{var t;let{setOpen:a,newMessage:s,setNewMessage:n,sendMessageHandler:c,messages:o,sellerId:d,userData:u,activeStatus:m,scrollRef:g,handleImageUpload:p}=e;const f=(0,v.U)();return l().createElement("div",{className:"w-full  user-inbox-open"},l().createElement("div",{className:"w-full flex p-3 items-center justify-between bg-slate-200"},l().createElement("div",{className:"flex"},l().createElement("img",{src:"".concat(null==u||null===(t=u.avatar)||void 0===t?void 0:t.url),alt:"",className:"w-[60px] h-[60px] rounded-full"}),l().createElement("div",{className:"pl-3"},l().createElement("h1",{className:"text-[18px] font-[600]"},null==u?void 0:u.name),l().createElement("h6",null,m?"Active Now":""))),l().createElement(r.K8z,{size:20,className:"cursor-pointer",onClick:()=>a(!1)})),l().createElement("div",{className:"px-3 py-3 overflow-y-scroll user-open-inbox"},o&&o.map(((e,t)=>{var a,s;return l().createElement("div",{className:"flex w-full my-2 ".concat(e.sender===d?"justify-end":"justify-start"),ref:g},e.sender!==d&&l().createElement("img",{src:"".concat(null==u||null===(a=u.avatar)||void 0===a?void 0:a.url),className:"w-[40px] h-[40px] rounded-full mr-3",alt:""}),e.images&&l().createElement("img",{src:"".concat(null===(s=e.images)||void 0===s?void 0:s.url),alt:"pic",className:"w-[300px] h-[300px] object-cover rounded-[10px] ml-2 mb-2"}),""!==e.text&&l().createElement("div",null,l().createElement("div",{className:"w-max p-2 rounded ".concat(e.sender===d?"bg-[#000]":"bg-[#38c776]"," text-[#fff] h-min")},l().createElement("p",null,e.text)),l().createElement("p",{className:"text-[12px] text-[#000000d3] pt-1"},N.format(new Date(e.createdAt)))))}))),l().createElement("form",{className:"p-3 relative w-full flex justify-between items-center",onSubmit:c},l().createElement("div",{className:"w-[30px]"},l().createElement("input",{type:"file",name:"",id:"image",className:"hidden",onChange:p}),l().createElement("label",{htmlFor:"image"},l().createElement(i.Il4,{className:"cursor-pointer",size:20}))),l().createElement("div",{className:"w-full"},l().createElement("input",{type:"text",required:!0,placeholder:"Enter your message...",value:s,onChange:e=>n(e.target.value),className:"".concat(f.input)}),l().createElement("input",{type:"submit",value:"Send",className:"hidden",id:"send"}),l().createElement("label",{htmlFor:"send"},l().createElement(r.APl,{size:20,className:"absolute right-4 top-5 cursor-pointer"})))))},S=()=>{const{user:e,loading:t}=(0,n.w1)((e=>e.user)),[a,o]=(0,s.useState)([]),[r,i]=(0,s.useState)(null),[d,u]=(0,s.useState)(),[v,N]=(0,s.useState)([]),[S,_]=(0,s.useState)(""),[M,D]=(0,s.useState)(null),[C,Y]=(0,s.useState)([]),[A,O]=(0,s.useState)(!1),[U,k]=(0,s.useState)(!1),P=(0,s.useRef)(null),T=(0,n.OY)(),[j,F]=(0,s.useState)();(0,b.c)({pageName:"inboxSEO",setState:F}),(0,s.useEffect)((()=>{if(e){let t={userId:null==e?void 0:e._id};T((0,x.cv)(t))}}),[T,e]),(0,s.useEffect)((()=>{E.I.on("getMessage",(e=>{i({sender:e.senderId,text:e.text,createdAt:Date.now()})}))}),[]),(0,s.useEffect)((()=>{r&&(null==d?void 0:d.members.includes(r.sender))&&N((e=>[...e,r]))}),[r,d]),(0,s.useEffect)((()=>{(async()=>{try{const t=await c.c.get("".concat(m.Yb,"/conversation/get-all-conversation-user/").concat(null==e?void 0:e._id),{withCredentials:!0});o(t.data.conversations)}catch(e){console.log(e)}})()}),[e,v]),(0,s.useEffect)((()=>{if(e){const t=null==e?void 0:e._id;E.I.emit("addUser",t),E.I.on("getUsers",(e=>{Y(e)}))}}),[e]);const R=t=>{const a=t.members.find((t=>t!==(null==e?void 0:e._id))),s=C.find((e=>e.userId===a));return!!s};(0,s.useEffect)((()=>{(async()=>{try{const e=await c.c.get("".concat(m.Yb,"/message/get-all-messages/").concat(null==d?void 0:d._id));N(e.data.messages)}catch(e){console.log(e)}})()}),[d]),(0,s.useEffect)((()=>{z(null==e?void 0:e._id,"64b0eb972e1cee5cac61bbbe")}),[e]);const z=async(t,a)=>{const s=a+e._id,l=e._id,n=a;c.c.post("".concat(m.Yb,"/conversation/create-new-conversation"),{groupTitle:s,userId:l,sellerId:n}).then((async t=>{try{await c.c.get("".concat(m.Yb,"/conversation/get-all-conversation-user/").concat(null==e?void 0:e._id),{withCredentials:!0})}catch(e){console.log(e)}})).catch((e=>{f.cp.error(e.response.data.message)}))},H=async()=>{await c.c.put("".concat(m.Yb,"/conversation/update-last-message/").concat(d._id),{lastMessage:"Photo",lastMessageId:e._id})};return(0,s.useEffect)((()=>{var e;null===(e=P.current)||void 0===e||e.scrollIntoView({beahaviour:"smooth"})}),[v]),l().createElement(l().Fragment,null,l().createElement(w.c,{seoDetails:j}),l().createElement(g.c,null),l().createElement(h.c,null),l().createElement("div",{className:"user-inbox"},l().createElement("div",{className:"container"},!U&&l().createElement(l().Fragment,null,l().createElement("h1",{className:"text-center text-[30px] py-3 font-Poppins"},"All Messages"),a&&a.map(((a,s)=>l().createElement(y,{data:a,key:s,index:s,setOpen:k,setCurrentChat:u,me:null==e?void 0:e._id,setUserData:D,userData:M,online:R(a),setActiveStatus:O,loading:t})))),U&&l().createElement(I,{setOpen:k,newMessage:S,setNewMessage:_,sendMessageHandler:async t=>{t.preventDefault();const a={sender:e._id,text:S,conversationId:d._id},s=d.members.find((t=>t!==(null==e?void 0:e._id)));E.I.emit("sendMessage",{senderId:null==e?void 0:e._id,receiverId:s,text:S});try{""!==S&&await c.c.post("".concat(m.Yb,"/message/create-new-message"),a).then((t=>{N([...v,t.data.message]),(async()=>{E.I.emit("updateLastMessage",{lastMessage:S,lastMessageId:e._id}),await c.c.put("".concat(m.Yb,"/conversation/update-last-message/").concat(d._id),{lastMessage:S,lastMessageId:e._id}).then((e=>{_("")})).catch((e=>{console.log(e)}))})()})).catch((e=>{console.log(e)}))}catch(e){console.log(e)}},messages:v,sellerId:e._id,userData:M,activeStatus:A,scrollRef:P,handleImageUpload:async t=>{const a=new FileReader;a.onload=()=>{2===a.readyState&&(async t=>{const a=d.members.find((t=>t!==e._id));E.I.emit("sendMessage",{senderId:e._id,receiverId:a,images:t});try{await c.c.post("".concat(m.Yb,"/message/create-new-message"),{images:t,sender:e._id,text:S,conversationId:d._id}).then((e=>{N([...v,e.data.message]),H()}))}catch(e){console.log(e)}})(a.result)},a.readAsDataURL(t.target.files[0])}}))),l().createElement(p.c,null))}},33280:(e,t,a)=>{a.d(t,{c:()=>n});var s=a(11504),l=a(85976);const n=e=>{let{pageName:t,setState:a,setLoading:n}=e;const c=(0,l.U)();(0,s.useEffect)((()=>{var e,s;n&&n(!1),null!=c&&c.allPagesSEODetails?a({metaTitle:null==c||null===(e=c.allPagesSEODetails)||void 0===e||null===(e=e[t])||void 0===e?void 0:e.metaTitle,metaDescription:null==c||null===(s=c.allPagesSEODetails)||void 0===s||null===(s=s[t])||void 0===s?void 0:s.metaDescription}):a({metaTitle:"Airbee Technologies",metaDescription:"Hirola Infotech Solutions provide your business with a variety of digital solutions to promote your product/service online for your growth."})}),[t,n,a,null==c?void 0:c.allPagesSEODetails])}}}]);