"use strict";(self.webpackChunkecom=self.webpackChunkecom||[]).push([[2376],{12376:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var s=a(11504),l=a.n(s),n=a(27768),c=a(53740),r=a(66564),o=a(96800),i=a(83284),d=a(44484),m=a(52328),u=a(82908),g=a(30919),p=a(27520),v=a(85704),f=a(85976);g.c.addDefaultLocale(p.c);const x=new g.c("en-US"),h=(0,u.cp)("https://chat.airbee.co.in/",{transports:["websocket"]}),E=e=>{var t;let{data:a,index:n,setOpen:c,setCurrentChat:o,me:d,setUserData:m,online:u,setActiveStatus:g,isLoading:p}=e;const[f,x]=(0,s.useState)([]),h=(0,i.i6)(),[E,w]=(0,s.useState)(0);return(0,s.useEffect)((()=>{const e=a.members.find((e=>e!==d));(async()=>{try{const t=await r.c.get("".concat(v.Yb,"/user/user-info/").concat(e));x(t.data.user)}catch(e){console.log(e)}})()}),[d,a]),l().createElement("div",{className:"w-[75%] mx-auto flex p-3 px-3 ".concat(E===n?"bg-[#00000010]":"bg-transparent","  cursor-pointer"),onClick:e=>{return w(n)||(t=a._id,h("/dashboard-messages?".concat(t)),void c(!0))||o(a)||m(f)||g(u);var t}},l().createElement("div",{className:"relative"},l().createElement("img",{src:"".concat(null==f||null===(t=f.avatar)||void 0===t?void 0:t.url),alt:"",className:"w-[50px] h-[50px] rounded-full"}),u?l().createElement("div",{className:"w-[12px] h-[12px] bg-green-400 rounded-full absolute top-[2px] right-[2px]"}):l().createElement("div",{className:"w-[12px] h-[12px] bg-[#c7b9b9] rounded-full absolute top-[2px] right-[2px]"})),l().createElement("div",{className:"pl-3"},l().createElement("h1",{className:"text-[18px]"},null==f?void 0:f.name),l().createElement("p",{className:"text-[16px] text-[#000c]"},p||(null==a?void 0:a.lastMessageId)===(null==f?void 0:f._id)?(null==f?void 0:f.name)+": ":"You:"," ",null==a?void 0:a.lastMessage)))},w=e=>{var t;let{scrollRef:a,setOpen:s,newMessage:n,setNewMessage:c,sendMessageHandler:r,messages:o,sellerId:i,userData:u,activeStatus:g,handleImageUpload:p}=e;const v=(0,f.U)();return l().createElement("div",{className:"w-full min-h-full flex flex-col justify-between"},l().createElement("div",{className:"w-full flex p-3 items-center justify-between bg-slate-200"},l().createElement("div",{className:"flex"},l().createElement("img",{src:"".concat(null==u||null===(t=u.avatar)||void 0===t?void 0:t.url),alt:"",className:"w-[60px] h-[60px] rounded-full"}),l().createElement("div",{className:"pl-3"},l().createElement("h1",{className:"text-[18px] font-[600]"},null==u?void 0:u.name),l().createElement("h1",null,g?"Active Now":""))),l().createElement(d.K8z,{size:20,className:"cursor-pointer",onClick:()=>s(!1)})),l().createElement("div",{className:"px-3 h-[65vh] py-3 overflow-y-scroll"},o&&o.map(((e,t)=>{var s,n;return l().createElement("div",{className:"flex w-full my-2 ".concat(e.sender===i?"justify-end":"justify-start"),ref:a,key:t},e.sender!==i&&l().createElement("img",{src:"".concat(null==u||null===(s=u.avatar)||void 0===s?void 0:s.url),className:"w-[40px] h-[40px] rounded-full mr-3",alt:""}),e.images&&l().createElement("img",{src:"".concat(null===(n=e.images)||void 0===n?void 0:n.url),alt:"pic",className:"w-[300px] h-[300px] object-cover rounded-[10px] mr-2"}),""!==e.text&&l().createElement("div",null,l().createElement("div",{className:"w-max p-2 rounded ".concat(e.sender===i?"bg-[#000]":"bg-[#38c776]"," text-[#fff] h-min")},l().createElement("p",null,e.text)),l().createElement("p",{className:"text-[12px] text-[#000000d3] pt-1"},x.format(new Date(e.createdAt)))))}))),l().createElement("form",{className:"p-3 relative w-full flex justify-between items-center",onSubmit:r},l().createElement("div",{className:"w-[30px]"},l().createElement("input",{type:"file",name:"",id:"image",className:"hidden",onChange:p}),l().createElement("label",{htmlFor:"image"},l().createElement(m.Il4,{className:"cursor-pointer",size:20}))),l().createElement("div",{className:"w-full"},l().createElement("input",{type:"text",required:!0,placeholder:"Enter your message...",value:n,onChange:e=>c(e.target.value),className:"".concat(v.input)}),l().createElement("input",{type:"submit",value:"Send",className:"hidden",id:"send"}),l().createElement("label",{htmlFor:"send"},l().createElement(d.APl,{size:20,className:"absolute right-4 top-5 cursor-pointer"})))))},b=()=>{const{seller:e,isLoading:t}=(0,o.w1)((e=>e.seller)),[a,n]=(0,s.useState)([]),[c,i]=(0,s.useState)(null),[d,m]=(0,s.useState)(),[u,g]=(0,s.useState)([]),[p,f]=(0,s.useState)(null),[x,b]=(0,s.useState)(""),[N,y]=(0,s.useState)([]),[_,M]=(0,s.useState)(!1),[S,I]=(0,s.useState)(!1),C=(0,s.useRef)(null);(0,s.useEffect)((()=>{h.on("getMessage",(e=>{i({sender:e.senderId,text:e.text,createdAt:Date.now()})}))}),[]),(0,s.useEffect)((()=>{c&&(null==d?void 0:d.members.includes(c.sender))&&g((e=>[...e,c]))}),[c,d]),(0,s.useEffect)((()=>{(async()=>{try{const t=await r.c.get("".concat(v.Yb,"/conversation/get-all-conversation-seller/").concat(null==e?void 0:e._id),{withCredentials:!0});n(t.data.conversations)}catch(e){}})()}),[e,u]),(0,s.useEffect)((()=>{if(e){const t=null==e?void 0:e._id;h.emit("addUser",t),h.on("getUsers",(e=>{y(e)}))}}),[e]);const D=t=>{const a=t.members.find((t=>t!==(null==e?void 0:e._id)));return!!N.find((e=>e.userId===a))};(0,s.useEffect)((()=>{(async()=>{try{const e=await r.c.get("".concat(v.Yb,"/message/get-all-messages/").concat(null==d?void 0:d._id));g(e.data.messages)}catch(e){console.log(e)}})()}),[d]);const k=async()=>{await r.c.put("".concat(v.Yb,"/conversation/update-last-message/").concat(d._id),{lastMessage:"Photo",lastMessageId:e._id})};return(0,s.useEffect)((()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView({beahaviour:"smooth"})}),[u]),l().createElement("div",{className:"w-[90%] bg-white m-5 h-[85vh] overflow-y-scroll rounded dashboard-message-box-user"},!S&&l().createElement(l().Fragment,null,l().createElement("h1",{className:"text-center text-[30px] py-3 font-Poppins"},"All Messages"),a&&a.map(((a,s)=>l().createElement(E,{data:a,key:s,index:s,setOpen:I,setCurrentChat:m,me:e._id,setUserData:f,userData:p,online:D(a),setActiveStatus:M,isLoading:t})))),S&&l().createElement(w,{setOpen:I,newMessage:x,setNewMessage:b,sendMessageHandler:async t=>{t.preventDefault();const a={sender:e._id,text:x,conversationId:d._id},s=d.members.find((t=>t.id!==e._id));h.emit("sendMessage",{senderId:e._id,receiverId:s,text:x});try{""!==x&&await r.c.post("".concat(v.Yb,"/message/create-new-message"),a).then((t=>{g([...u,t.data.message]),(async()=>{h.emit("updateLastMessage",{lastMessage:x,lastMessageId:e._id}),await r.c.put("".concat(v.Yb,"/conversation/update-last-message/").concat(d._id),{lastMessage:x,lastMessageId:e._id}).then((e=>{b("")})).catch((e=>{console.log(e)}))})()})).catch((e=>{console.log(e)}))}catch(e){console.log(e)}},messages:u,sellerId:e._id,userData:p,activeStatus:_,scrollRef:C,setMessages:g,handleImageUpload:async t=>{const a=new FileReader;a.onload=()=>{2===a.readyState&&(async t=>{const a=d.members.find((t=>t!==e._id));h.emit("sendMessage",{senderId:e._id,receiverId:a,images:t});try{await r.c.post("".concat(v.Yb,"/message/create-new-message"),{images:t,sender:e._id,text:x,conversationId:d._id}).then((e=>{g([...u,e.data.message]),k()}))}catch(e){console.log(e)}})(a.result)},a.readAsDataURL(t.target.files[0])}}))};var N=a(93736);const y=()=>l().createElement("div",null,l().createElement(n.c,{active:4}),l().createElement("div",{className:"flex items-start justify-between w-full dasboard-user-width-mobile"},l().createElement("div",{className:"800px:w-[330px] dashboard-side-bar-res"},l().createElement(c.c,{active:37})),l().createElement(b,null)),l().createElement(N.c,null))}}]);